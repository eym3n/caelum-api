from dotenv import load_dotenv
from pydantic import BaseModel, Field
from typing import Annotated, Dict, Any
from langgraph.graph.message import add_messages

load_dotenv()


def replace(a, b):
    return b


class BuilderState(BaseModel):
    """Shared state between Designer, Coder, Clarifier, and other agents in the landing page builder graph."""

    # ğŸ—£ï¸ Core conversational stream
    messages: Annotated[list, add_messages]

    # ğŸ§­ Intent management
    user_intent: Annotated[str, replace]
    found_error: Annotated[bool, replace]

    # ğŸ§° Diff / change tracking (used by Coder Agent)
    lines_added: Annotated[int, replace]
    lines_removed: Annotated[int, replace]

    # ğŸ¨ Design System (Designer Agent)
    raw_designer_output: Annotated[str, replace] = Field(
        default="",
        description="Raw unstructured output from Designer Agent.",
    )
    design_guidelines: Annotated[str, replace] = Field(
        default="", description="Optional user-specified design or brand guidelines."
    )
    design_manifest: Annotated[Dict[str, Any], replace] = Field(
        default_factory=dict,
        description="Generated design_manifest.json from Designer Agent.",
    )
    component_specs: Annotated[Dict[str, Any], replace] = Field(
        default_factory=dict,
        description="Dictionary of component_specs/*.json for each component.",
    )
    tokens_css: Annotated[str, replace] = Field(
        default="", description="Generated tokens.css containing CSS variables."
    )
    accessibility_report: Annotated[str, replace] = Field(
        default="", description="Accessibility report (markdown)."
    )
    byoc_export: Annotated[Dict[str, Any], replace] = Field(
        default_factory=dict, description="JSON export compatible with Sitecore BYOC."
    )
    design_system_run: Annotated[bool, replace] = Field(
        default=False,
        description="Indicates whether the design system pass has completed for the session.",
    )

    # ğŸ’» Coder Agent
    coder_output: Annotated[str, replace] = Field(
        default="", description="Summary or code changes generated by the Coder Agent."
    )

    # ğŸ’¬ Clarifier Agent
    clarify_response: Annotated[str, replace] = Field(
        default="",
        description="Response from Clarifier Agent when no code/design action is needed.",
    )
